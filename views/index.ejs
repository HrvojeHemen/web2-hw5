<!DOCTYPE html>
<html>
<script>
    if ('storage' in navigator && 'estimate' in navigator.storage) {
        navigator.storage.estimate()
            .then(estimate => {
                document.getElementById('usage').innerHTML = estimate.usage;
                document.getElementById('quota').innerHTML = estimate.quota;
                document.getElementById('percent').innerHTML = (estimate.usage * 100 / estimate.quota).toFixed(0);
            });
    }

    if ('storage' in navigator && 'persisted' in navigator.storage) {
        navigator.storage.persisted()
            .then(persisted => {
                document.getElementById('persisted').innerHTML = persisted ? 'persisted' : 'not persisted';
            });
    }

    function requestPersistence() {
        if ('storage' in navigator && 'persist' in navigator.storage) {
            navigator.storage.persist()
                .then(persisted => {
                    document.getElementById('persisted').innerHTML = persisted ? 'persisted' : 'not persisted';
                });
        }
    }

    function getConnection() {
        return navigator.connection || navigator.mozConnection ||
            navigator.webkitConnection || navigator.msConnection;
    }

    function updateNetworkInfo(info) {
        document.getElementById('networkType').innerHTML = info.type;
        document.getElementById('effectiveNetworkType').innerHTML = info.effectiveType;
        document.getElementById('downlinkMax').innerHTML = info.downlinkMax;
    }

    var info = getConnection();
    if (info) {
        info.onchange = function (event) {
            updateNetworkInfo(event.target);
        }
        updateNetworkInfo(info);
    }
</script>
<head>
    <title><%= title %></title>
    <link rel='stylesheet' href='/stylesheets/style.css'/>
</head>
<body>
<h1><%= title %></h1>
<p>Welcome to <%= title %></p>

<p>Estimated storage usage is <b id="usage">unknown</b> bytes.</p>
<p>Estimated storage quota is <b id="quota">unknown</b> bytes.</p>
<p>Estimated usage is <b id="percent">unknown</b>%.</p>
<p>Persistent storage status is <b id="persisted">unknown</b>.</p>

<p>Current theoretical network type is <b id="networkType">not available</b>.</p>
<p>Current effective network type is <b id="effectiveNetworkType">not available</b>.</p>
<p>Current max downlink speed is <b id="downlinkMax">not available</b>.
<p>
    <button onclick="requestPersistence()">Request persistent storage</button>
</p>
</body>
</html>
